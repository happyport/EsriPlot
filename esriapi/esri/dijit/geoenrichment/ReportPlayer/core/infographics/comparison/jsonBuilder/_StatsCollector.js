// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.30/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/infographics/comparison/jsonBuilder/_StatsCollector",["dojo/_base/lang","../../../comparison/ComparisonListUtil","esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/stdGeographies/StdGeographiesUtil"],function(t,u,v){var p={getStats:function(f,c,d,b,e){var g=[],m=[],k=[],h=0,l=0,w=1<c.length?"shortName":"name";c.forEach(function(a,c){var n=t.mixin({},a.data);f&&(g.push(n),n.StdGeographyName=b&&b[c][w],n.__thisAreaIndex=c);m=m.concat(a.comparisonLevels)});
c=p._comparisonLevelsToGroups(m);var a=c.groups,h=h+g.length;a.forEach(function(a){h+=a.features.length});e=p._collectRangesAndFilterAttributes(g,a,e);var q=g.filter(function(a){return!!a}).length,l=l+q;a.forEach(function(a){l+=a.features.length});var r={};a.forEach(function(a){a.cache={};a.features.forEach(function(b){a.cache[b.attributes.StdGeographyID]=b});var b=a.cache[d[a.levelId]]||a.features[0];k.push(b&&b.attributes);b&&(r[a.levelId]=a)});return{ranges:e,thisAreas:g,shownGeographiesInGroup:k,
groups:r,numThisAreas:q,numAreasTotal:h,numAreasShown:l,allGeographies:c.features.map(function(a){return a.attributes})}},_comparisonLevelsToGroups:function(f){var c=[],d=[];f.forEach(function(b){if(b.StdGeographyID){var e=b.StdGeographyID+";"+b.StdGeographyLevel+";"+b.StdGeographyName+";";c[e]||(c[e]=!0,b.StdGeographyName&&(e=v.getAreaName(b),e!==b.StdGeographyName&&(b.StdGeographyName=e)),d.push({attributes:b}))}else console.log("Error: Can't add a feature to a group.")});return{features:d,groups:u.getFeatureGroups(d)}},
_collectRangesAndFilterAttributes:function(f,c,d){function b(b){k.forEach(function(a){var c=b[a.fieldName];isNaN(c)||(a.min=Math.min(a.min,c),a.max=Math.max(a.max,c),a.dataArray.push(c))})}function e(b){return!k.some(function(a){var c=d[a.fieldName];a=b[a.fieldName];return c&&(a<c.min||a>c.max)})}var g;d&&(g={},d.forEach(function(b){g[b.fieldName]=b}),d=g);var m=f[0]||c[0]&&c[0].features[0]&&c[0].features[0].attributes,k=[],h;for(h in m)if("__thisAreaIndex"!==h){var l=m[h];"number"!==typeof l||isNaN(l)||
k.push({fieldName:h,min:Infinity,max:-Infinity,dataArray:[]})}f.forEach(function(c,a){b(c);d&&!e(c)&&(f[a]=void 0)});c.forEach(function(c){c.features=c.features.filter(function(a){b(a.attributes);return!d||e(a.attributes)})});return k},applyFieldsToRanges:function(f,c){var d={};f.forEach(function(b){d[b.name]=b});return c.filter(function(b){field=d[b.fieldName];if(!field)return!1;b.alias=field.label;b.decimals=field.decimals;return!0})}};return p});