// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.30/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/ChartFilterUtil",["dojo/_base/lang","esri/dijit/geoenrichment/utils/ObjectUtil","./ChartTypes","./builder/utils/ChartDataUtil"],function(q,t,u,m){var l={collectStatsForVariables:function(b,c,k,h,e){var f=0,a={min:Infinity,max:-Infinity,decimals:0,dataArray:[]};c.forEach(function(d,n){d.points.forEach(function(g,c){g=m.getPointValue({point:g,viewModel:h,currentFeatureIndex:e,index:c,seriesIndex:n,chartType:b,visualProperties:k,numPoints:d.points.length});
a.min=Math.min(a.min,g);a.max=Math.max(a.max,g);a.decimals=Math.max(a.decimals,t.getPlaces(g));a.dataArray.push(g);f++})});return{filterRanges:[a],numVariablesTotal:f}},filterSeriesItems:function(b,c,k,h,e,f,a){return a?l._filterAreas(b,c,h,e):l._filterVariables(b,c,k,h,e,f)},_filterAreas:function(b,c,k,h){var e=0,f={};k.forEach(function(a){f[a.fieldName]=a});if(u.isLineLike(b))b=c.filter(function(a,b){return!a.points.some(function(a){var d=m.getPointValue({point:a,viewModel:h,currentFeatureIndex:b});
a=f[a.fieldInfo.name];return d<a.min||d>a.max})}),e=b.length,b.length||(b.__firstSeriesItem=c[0]);else{var a={};c.forEach(function(b){b.points.forEach(function(b,d){if(!a[d]){var c=m.getPointValue({point:b,viewModel:h,currentFeatureIndex:d});b=f[b.fieldInfo.name];if(c<b.min||c>b.max)a[d]=!0}})});b=c.map(function(b){b=q.mixin({},b);b.__firstPoint=b.points[0];b.points=b.points.filter(function(b,c){return!a[c]});e=b.points.length;return b})}return{seriesItems:b,numShownElements:e}},_filterVariables:function(b,
c,k,h,e,f){var a,d=0,n=h[0];a=[];var g=1<c.length;c.forEach(function(r,c){seriesItemCopy=q.mixin({},r);seriesItemCopy.points=[];r.points.forEach(function(a,d){a.originalIndex=d;d=m.getPointValue({point:a,viewModel:e,currentFeatureIndex:f,index:d,seriesIndex:c,chartType:b,visualProperties:k,numPoints:r.points.length});d<n.min||d>n.max?g&&(a=q.mixin({},a),a.hidden=!0,seriesItemCopy.points.push(a)):seriesItemCopy.points.push(a)});g?a.push(seriesItemCopy):seriesItemCopy.points.length&&a.push(seriesItemCopy)});
if(g){var l=0;a.forEach(function(a){l=Math.max(l,a.points.length)});for(var p=0;p<l;p++)a.every(function(a){a=a.points[p];return!a||a.hidden})&&a.forEach(function(a){if(a=a.points[p])a._toRemove=!0});a=a.filter(function(a){a.points=a.points.filter(function(a){return!a._toRemove});return a.points.length})}a.forEach(function(a){a.points.forEach(function(a){a.hidden||d++})});return{seriesItems:a,numShownElements:d}},getFirstSeriesPoint:function(b){return b.__firstPoint},getFirstSeriesItem:function(b){return b.__firstSeriesItem}};
return l});