// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.30/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/ReportTemplateData","dojo/_base/declare dojo/_base/lang dojo/request/xhr esri/dijit/geoenrichment/promise/all esri/kernel esri/request esri/urlUtils esri/dijit/geoenrichment/utils/DataUtil esri/dijit/geoenrichment/utils/PortalUtil esri/dijit/geoenrichment/utils/UrlUtil esri/dijit/geoenrichment/utils/requests/FileContent esri/dijit/geoenrichment/utils/requests/UniversalClient".split(" "),function(d,l,m,n,f,p,q,g,r,t,u,h){function k(a,
b){var c=a.substr(a.lastIndexOf("/")+1),e=q.getProxyRule(a);return m(e&&e.proxyUrl?e.proxyUrl+"?"+a:a,{method:"POST",handleAs:"arraybuffer",data:"token\x3d"+b,headers:{"X-Requested-With":null,"Content-Type":"application/x-www-form-urlencoded; charset\x3dutf-8"}}).then(function(a){var b=!/\.xml$|\.txt$|\.json$/i.test(c);return{name:c,data:b?g.base64FromByteSource(a):decodeURIComponent(escape(g.binaryStringFromByteSource(a)))}})}d=d(null,{id:null,_portalUrl:null,_baseUrl:null,constructor:function(a,
b){this.id=a.id;this._portalUrl=b;this._baseUrl=t.combine(this._portalUrl,"sharing/rest")},getFiles:function(){var a=this;return this._getResources().then(function(b){var c=[];b.map(function(b){b=b.resource;"thumbnail.png"!==b&&c.push(a.getFileByName(b))});return n(c)})},getFileByName:function(a){a=this._baseUrl+"/"+this._contentItemPath(this.id+"/resources/"+a);return k(a,this._getToken())},updateFile:function(a,b){var c=this;return h.request({url:this._baseUrl,urlSuffix:"content/items/"+this.id}).then(function(e){var d=
u.fromFileData(a,b);return h.request({url:c._baseUrl,urlSuffix:"content/users/"+e.owner+"/"+e.ownerFolder+"/items/"+c.id+"/updateResources"},{content:{file:d,filename:a}})})},_contentItemPath:function(a){return"content/items/"+a},_getToken:function(){var a=f.id.findCredential(this._portalUrl)||f.id.credentials[0];return a&&a.token},_getResources:function(){var a=this;return r.query(function(b){return p({url:a._baseUrl+"/"+a._contentItemPath(a.id+"/resources"),content:l.mixin({f:"json",token:a._getToken()},
b),handleAs:"json"},{usePost:!0})},null,"resources").then(function(a){return a.resources})},getPortalUrl:function(a){return a?/[^:]+:\/\/(.+)$/i.exec(this._portalUrl)[1]:this._portalUrl}});d.loadResource=k;return d});