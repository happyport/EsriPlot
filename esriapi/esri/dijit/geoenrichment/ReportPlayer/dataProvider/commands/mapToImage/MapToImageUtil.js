// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.30/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/mapToImage/MapToImageUtil","esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when dojo/dom-construct esri/dijit/geoenrichment/promise/all ./MapToURLUtil ./_MapReplacer".split(" "),function(p,f,q,m,d,n){var c={};c.enableCaching=d.enableCaching;c.clearCaching=d.clearCaching;c.replaceMapWithImage=function(a,b){b=b||{};var g=[],c={errors:[],undo:function(){g.map(function(b){b()})}},k=a.collectMaps({allAreas:!0}),l=[];return m(k.map(function(e){return f(d.mapToURL(e.map,
e.legend,e.node),function(c){var a=n.replaceMapWithImage(e.node);g.push(a.undo);l.push(e);var h=new p;a.mapImage.onload=h.resolve;a.mapImage.onerror=function(b){console.log(b);q.destroy(a.mapImage);h.resolve()};f(d.urlToSrc(c,b),function(b){a.mapImage.src=b});return h.promise})})).always(function(){l.length!==k.length&&(k.forEach(function(b){-1===l.indexOf(b)&&(b=n.replaceMapWithImage(b.node),g.push(b.undo))}),c.errors.push(Error("Some maps can't be exported")));return c})};c.mapInfoToDataUrl=function(a,
b){b=b||{};return f(d.mapToURL(a.map,a.legend,a.node,b),function(a){return d.urlToSrc(a,b)})};c.collectMapsAsImages=function(a,b){b=b||{};a=a.collectMaps({allAreas:!0});return m(a.map(function(a){return f(d.mapToURL(a.map,a.legend,a.node,b),function(a){return d.urlToSrc(a,b)}).otherwise(function(){return null}).then(function(b){return{url:b,itemId:a.itemId,areaIndex:a.areaIndex,position:a.position}})}))};return c});