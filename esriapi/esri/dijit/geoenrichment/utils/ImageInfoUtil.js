// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.30/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/ImageInfoUtil",["dojo/_base/lang","esri/dijit/geoenrichment/when","./ImageUtil","./UrlUtil"],function(m,f,l,n){var d={_infoCache:{},getImageInfo:function(a,e,h){var g=h&&h.sizeLimit||1E5;d._infoCache[a]||(d._infoCache[a]=l.imageFromUrl(a).then(function(k){var b=l.imageToDataURL(k),c={dataUrl:b,contentType:l.getContentType(b),width:k.width,height:k.height};setTimeout(function(){d._infoCache[a]=c});return c}));return f(d._infoCache[a],function(a){a=m.mixin({},
a);e&&(a.filename=e&&e.replace(/\.\w+$/,".png").toLowerCase());return function(a){return f(d._processDataUrl(a,g),function(c){if(c&&c.dataUrl){var b=m.mixin({},a);b.dataUrl=c.dataUrl;b.width*=c.factor;b.height*=c.factor;return f(b)}return f(a)})}(a)})},getRemoteImageDataUrl:function(a,e){function h(b){var c=a;b&&(b=n.getProxyUrl())&&(c=b+"?"+c);return d.getImageInfo(c)}function g(a){return f(d._processDataUrl(a,k),function(a){return a&&a.dataUrl||a})}var k=e&&e.sizeLimit||1E5;return f(h(!1),function(a){return g(a)},
function(){return f(h(!0),function(a){return g(a)},function(){return a})})},_processDataUrl:function(a,e){var d=Math.max(a.width,a.height);if(d<=e)return a.dataUrl;var g=e/d;return f(l.scaleImage(a.dataUrl,{factor:g}),function(a){return{dataUrl:a,factor:g}})}};return d});