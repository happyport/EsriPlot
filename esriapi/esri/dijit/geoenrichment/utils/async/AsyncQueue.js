// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.30/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/async/AsyncQueue","dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when dijit/Destroyable ../DelayUtil".split(" "),function(m,n,h,e,p,k){var g=m(p,{_lastPromise:null,_isFinished:!1,_isDestroyed:!1,_lastDfd:null,_lastResult:null,constructor:function(b){n.mixin(this,b)},add:function(b,d){d=d||{};var a=this;if(!this._isDestroyed){this._lastDfd||(this.onStarted(),this._lastDfd=new h);this._isFinished=!1;var f=function(){var l=
function(){if(!a._isDestroyed)try{return"function"===typeof b?b():b}catch(q){return(new h).reject(q)}},c=0<=d.delayBefore?function(){return k.delay(l,d.delayBefore)}:l;return(0<=d.delayAfter?function(){return e(c(),function(a){return k.delay(function(){return a},d.delayAfter)})}:c)()};!this._lastPromise||this._lastPromise.isFulfilled()?this._lastPromise=e(f()):this._lastPromise=e(this._lastPromise).then(f);var c=this._lastPromise;e(c,function(b){c!==a._lastPromise||a._isDestroyed||a._isFinished||
c&&!c.isFulfilled()||(a._isFinished=!0,a._lastDfd.resolve(b),a._lastResult=b,a._lastDfd=null,a.onFinished(b))},this._lastDfd.reject);return this.getPromise()}},getPromise:function(){return this._isDestroyed?null:this._lastDfd&&this._lastDfd.promise||this._lastResult},isFinished:function(){return this._isFinished},isDestroyed:function(){return this._isDestroyed},destroy:function(){this._isDestroyed=!0},onStarted:function(){},onFinished:function(b){}});g.executeFunctions=function(b,d,a){a=a||{};var f=
new g,c=[];b.forEach(function(a,b){f.add(function(){return e(a(),function(a){c.push(a);return a})},{delayBefore:0===b?void 0:d})});a.onQueueReady&&a.onQueueReady(f);return e(f.getPromise(),function(b){return a.collectResults?c:b})};g.processArrayInBatches=function(b,d){function a(){if(b.length){for(var c=[],e=0;e<d.batchSize&&b.length;e++)c.push(b.shift());c.forEach(d.callback);setTimeout(a,d.timeout||0)}else f.resolve()}b=b.slice();var f=new h;a();return f.promise};return g});