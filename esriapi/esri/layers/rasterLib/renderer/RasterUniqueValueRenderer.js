// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.30/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/renderer/RasterUniqueValueRenderer",["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(t,w,u,r,v){return t([u],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",alias:"",uniqueValueInfos:null,constructor:function(e){e&&e.colormap&&(this.colormap=e.colormap,this._function=new r(e),this._function.outputPixelType="U8",this._function.renderTexture=
!0)},bind:function(e){this.inherited(arguments);if(!this._function){var b=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!b)throw"uv renderer requires data source to have raster attribute table";var c=this.attributeField||this.field1||this.field,f=this.infos||this.uniqueValueInfos;this.defaultColor=this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var h,g=b.fields.filter(function(a){return"value"===a.name.toLowerCase()})[0];g&&(h=g.name);c||((c=b.fields.filter(function(a){return-1<
["classname","category"].indexOf(a.name.toLowerCase())})[0])||(c=b.fields.filter(function(a){return"esriFieldTypeString"===a.type})[0]),this.alias=(this.field=c=c&&c.name||h)&&c.alias||h);var n=[],p,d,q,k,l,m;if(!f){f=[];q=b.fields.filter(function(a){return"alpha"===a.name.toLowerCase()})[0];k=b.fields.filter(function(a){return"red"===a.name.toLowerCase()})[0];l=b.fields.filter(function(a){return"green"===a.name.toLowerCase()})[0];m=b.fields.filter(function(a){return"blue"===a.name.toLowerCase()})[0];
for(g=0;g<b.features.length;g++)d=b.features[g].attributes,(p=f.some(function(a){a.value===d[c]}))||(q&&k&&l&&m?f.push({value:d[c],alias:d[c],color:[d[k.name],d[l.name],d[m.name],d[q.name]]}):k&&l&&m?f.push({value:d[c],alias:d[c],color:[d[k.name],d[l.name],d[m.name]]}):f.push({value:d[c],alias:d[c]}));if(!(k&&l&&m))for(p=v.createRandomColorRamp({size:f.length}),g=0;g<f.length;g++)f[g].color=p[g];this.uniqueValueInfos=f}if(f)f.forEach(function(a){n=n.concat(b.features.filter(function(b){return a.value==
b.attributes[c]}).map(function(b){return[b.attributes[h]].concat(a.color||a.symbol&&a.symbol.color)}))}),this.defaultColor&&b.features.filter(function(a){n.some(function(b){return b[0]===a.attributes[h]})||n.push([a.attributes[h]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=new r({colormap:n});this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(e){e=this._clonePixelData(e);
return e=this._function._colorize(e)},drawGL:function(e){this._function._colorizeGL(e)},toJson:function(e){var b={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};e&&(b.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:b}}})});